# ESPHome Display Node Template
# SSD1306 OLED display with DHT22 sensor showing temperature and humidity

substitutions:
  device_name: display-node
  friendly_name: Display Node
  dht_pin: GPIO4

esphome:
  name: ${device_name}
  friendly_name: ${friendly_name}
  platform: ESP32
  board: esp32dev

# WiFi configuration
wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password

  # Enable fallback hotspot
  ap:
    ssid: "${friendly_name} Fallback"
    password: !secret fallback_password

captive_portal:

# Enable logging
logger:

# Enable Home Assistant API
api:
  encryption:
    key: !secret api_encryption_key

# Enable OTA updates
ota:
  - platform: esphome
    password: !secret ota_password

# I2C Bus for Display
i2c:
  sda: GPIO21
  scl: GPIO22
  scan: true

# Fonts for display
font:
  - file: "gfonts://Roboto"
    id: roboto_16
    size: 16

  - file: "gfonts://Roboto"
    id: roboto_12
    size: 12

# DHT22 Temperature/Humidity Sensor
sensor:
  - platform: dht
    pin: ${dht_pin}
    model: DHT22
    temperature:
      name: "${friendly_name} Temperature"
      id: temp_sensor
    humidity:
      name: "${friendly_name} Humidity"
      id: humidity_sensor
    update_interval: 10s

  # WiFi Signal
  - platform: wifi_signal
    name: "${friendly_name} WiFi Signal"
    id: wifi_signal_sensor
    update_interval: 60s

# SSD1306 OLED Display (128x64, I2C)
display:
  - platform: ssd1306_i2c
    model: "SSD1306 128x64"
    address: 0x3C
    lambda: |-
      // Display title
      it.printf(64, 0, id(roboto_16), TextAlign::TOP_CENTER, "${friendly_name}");

      // Display temperature
      if (id(temp_sensor).has_state()) {
        it.printf(0, 20, id(roboto_12), "Temp: %.1fÂ°C", id(temp_sensor).state);
      }

      // Display humidity
      if (id(humidity_sensor).has_state()) {
        it.printf(0, 35, id(roboto_12), "Hum:  %.1f%%", id(humidity_sensor).state);
      }

      // Display WiFi signal strength
      if (id(wifi_signal_sensor).has_state()) {
        it.printf(0, 50, id(roboto_12), "WiFi: %.0f dBm", id(wifi_signal_sensor).state);
      }

# Text sensors
text_sensor:
  - platform: wifi_info
    ip_address:
      name: "${friendly_name} IP Address"

  - platform: version
    name: "${friendly_name} ESPHome Version"

# Binary sensor for device status
binary_sensor:
  - platform: status
    name: "${friendly_name} Status"
