# ESPHome 4-Channel Relay Controller Template
# Control 4 relays with physical buttons and Home Assistant integration

substitutions:
  device_name: relay-controller
  friendly_name: Relay Controller

  # Relay GPIO pins (adjust based on your board)
  relay1_pin: GPIO23
  relay2_pin: GPIO22
  relay3_pin: GPIO21
  relay4_pin: GPIO19

  # Button GPIO pins (optional physical buttons)
  button1_pin: GPIO18
  button2_pin: GPIO17
  button3_pin: GPIO16
  button4_pin: GPIO5

esphome:
  name: ${device_name}
  friendly_name: ${friendly_name}
  platform: ESP32
  board: esp32dev

# WiFi configuration
wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password

  # Enable fallback hotspot
  ap:
    ssid: "${friendly_name} Fallback"
    password: !secret fallback_password

captive_portal:

# Enable logging
logger:

# Enable Home Assistant API
api:
  encryption:
    key: !secret api_encryption_key

# Enable OTA updates
ota:
  - platform: esphome
    password: !secret ota_password

# Switches (Relays)
switch:
  - platform: gpio
    pin: ${relay1_pin}
    name: "${friendly_name} Relay 1"
    id: relay_1
    restore_mode: RESTORE_DEFAULT_OFF

  - platform: gpio
    pin: ${relay2_pin}
    name: "${friendly_name} Relay 2"
    id: relay_2
    restore_mode: RESTORE_DEFAULT_OFF

  - platform: gpio
    pin: ${relay3_pin}
    name: "${friendly_name} Relay 3"
    id: relay_3
    restore_mode: RESTORE_DEFAULT_OFF

  - platform: gpio
    pin: ${relay4_pin}
    name: "${friendly_name} Relay 4"
    id: relay_4
    restore_mode: RESTORE_DEFAULT_OFF

# Binary Sensors (Physical Buttons)
binary_sensor:
  - platform: gpio
    pin:
      number: ${button1_pin}
      mode: INPUT_PULLUP
      inverted: true
    name: "${friendly_name} Button 1"
    on_press:
      - switch.toggle: relay_1

  - platform: gpio
    pin:
      number: ${button2_pin}
      mode: INPUT_PULLUP
      inverted: true
    name: "${friendly_name} Button 2"
    on_press:
      - switch.toggle: relay_2

  - platform: gpio
    pin:
      number: ${button3_pin}
      mode: INPUT_PULLUP
      inverted: true
    name: "${friendly_name} Button 3"
    on_press:
      - switch.toggle: relay_3

  - platform: gpio
    pin:
      number: ${button4_pin}
      mode: INPUT_PULLUP
      inverted: true
    name: "${friendly_name} Button 4"
    on_press:
      - switch.toggle: relay_4

  # Status indicator
  - platform: status
    name: "${friendly_name} Status"

# Sensors
sensor:
  # WiFi Signal
  - platform: wifi_signal
    name: "${friendly_name} WiFi Signal"
    update_interval: 60s

  # Uptime
  - platform: uptime
    name: "${friendly_name} Uptime"
    update_interval: 60s

# Text sensors
text_sensor:
  - platform: wifi_info
    ip_address:
      name: "${friendly_name} IP Address"

  - platform: version
    name: "${friendly_name} ESPHome Version"

# Optional: Interlock to prevent multiple relays on simultaneously
# Uncomment if needed
# switch:
#   - platform: gpio
#     pin: ${relay1_pin}
#     name: "${friendly_name} Relay 1"
#     id: relay_1
#     interlock: &interlock_group [relay_1, relay_2, relay_3, relay_4]
#     interlock_wait_time: 100ms
