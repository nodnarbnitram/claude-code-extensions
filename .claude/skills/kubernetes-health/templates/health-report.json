{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Kubernetes Health Report",
  "description": "Unified health report from cluster diagnostics",
  "type": "object",
  "properties": {
    "cluster": {
      "type": "string",
      "description": "Cluster name from kubectl context"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of report generation"
    },
    "discovery": {
      "type": "object",
      "description": "API discovery metadata",
      "properties": {
        "duration_ms": {
          "type": "integer",
          "description": "Time taken for API discovery in milliseconds"
        },
        "api_groups_found": {
          "type": "integer",
          "description": "Total number of API groups discovered"
        },
        "custom_resources": {
          "type": "integer",
          "description": "Number of custom resource definitions found"
        },
        "active_sub_agents": {
          "type": "integer",
          "description": "Number of health agents activated"
        }
      }
    },
    "detected_operators": {
      "type": "array",
      "description": "List of detected Kubernetes operators",
      "items": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "description": "Operator name (e.g., Crossplane, ArgoCD)"
          },
          "version": {
            "type": "string",
            "description": "Detected operator version if available"
          },
          "status": {
            "type": "string",
            "enum": ["active", "inactive", "unknown"],
            "description": "Operator status"
          }
        },
        "required": ["name", "status"]
      }
    },
    "components": {
      "type": "object",
      "description": "Health reports per component",
      "additionalProperties": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": ["HEALTHY", "DEGRADED", "CRITICAL"],
            "description": "Component health status"
          },
          "score": {
            "type": "number",
            "minimum": 0,
            "maximum": 100,
            "description": "Component health score (0-100)"
          },
          "checks": {
            "type": "array",
            "description": "Individual health check results",
            "items": {
              "type": "object",
              "properties": {
                "name": {
                  "type": "string",
                  "description": "Check name"
                },
                "status": {
                  "type": "string",
                  "enum": ["OK", "WARNING", "ERROR"],
                  "description": "Check result status"
                },
                "message": {
                  "type": "string",
                  "description": "Human-readable status message"
                },
                "category": {
                  "type": "string",
                  "enum": ["availability", "configuration", "freshness", "resources"],
                  "description": "Check category for scoring"
                },
                "details": {
                  "type": "object",
                  "description": "Additional check-specific details"
                }
              },
              "required": ["name", "status"]
            }
          },
          "recommendations": {
            "type": "array",
            "description": "Recommended actions for this component",
            "items": {
              "type": "string"
            }
          }
        },
        "required": ["status", "score", "checks"]
      }
    },
    "overall": {
      "type": "object",
      "description": "Overall cluster health summary",
      "properties": {
        "status": {
          "type": "string",
          "enum": ["HEALTHY", "DEGRADED", "CRITICAL"],
          "description": "Overall cluster health status"
        },
        "score": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Overall health score (0-100)"
        },
        "critical_issues": {
          "type": "array",
          "description": "Critical issues requiring immediate attention",
          "items": {
            "type": "object",
            "properties": {
              "component": {
                "type": "string"
              },
              "check": {
                "type": "string"
              },
              "severity": {
                "type": "string"
              },
              "message": {
                "type": "string"
              }
            }
          }
        },
        "recommendations": {
          "type": "array",
          "description": "Prioritized recommendations across all components",
          "items": {
            "type": "string"
          }
        }
      },
      "required": ["status", "score"]
    }
  },
  "required": ["cluster", "timestamp", "components", "overall"]
}
