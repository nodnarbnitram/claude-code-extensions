---
description: Create a Linear ticket, branch, commit staged changes, and open a PR
argument-hint: <team> ["title"]
allowed-tools: Bash(linearis issues create:*), Bash(git checkout:*), Bash(git add:*), Bash(git commit:*), Bash(git push:*), Bash(git status:*), Bash(git diff:*), Bash(git log:*), Bash(gh pr create:*), Bash(rm:*)
---

# Create Linear PR Workflow

Create a Linear ticket, branch from it, commit changes, and open a pull request.

## Context

- Current git status: !`git status --short`
- Current branch: !`git branch --show-current`
- Staged changes: !`git diff --cached --stat`
- Unstaged changes: !`git diff --stat`

## Arguments

- `$1` - Team identifier (e.g., `ICE-T`)
- `$2` - Optional ticket title. If not provided, derive from the changes.

If team is missing, ask the user for it.

## Prerequisites

- Changes should already be made to files (staged or unstaged)
- `linearis` CLI must be configured
- `gh` CLI must be authenticated

## Steps

Track these steps as TODOs and complete them one by one.

1. **Validate arguments** - Ensure `$1` (team) is provided.
   - If team is missing, ask the user for it.

2. **Review changes** - Analyze the context above to understand what will be committed.
   - If no changes exist (no staged or unstaged files), stop and inform the user.
   - Summarize the changes for the user.
   - If `$2` (title) not provided, derive a concise title from the changes.

3. **Create Linear ticket** - Use linearis to create the ticket:
   ```bash
   linearis issues create --team $1 -d "<auto-generated description>" "<title from $2 or derived>"
   ```
   - Generate a meaningful description based on the changes being committed.
   - Extract `identifier` and `branchName` from the JSON response.

4. **Create branch** - Create and checkout the branch:
   ```bash
   git checkout -b <branchName from linearis response>
   ```

5. **Stage and commit** - Stage relevant changes and commit:
   ```bash
   git add <relevant files>
   git commit -m "$(cat <<'EOF'
   <TICKET-ID>: <title>

   <detailed description of changes>
   EOF
   )"
   ```
   - Always use HEREDOC for commit messages.
   - Include the ticket ID prefix.

6. **Push branch** - Push to origin with tracking:
   ```bash
   git push -u origin <branch-name>
   ```

7. **Create PR** - Open a pull request:
   ```bash
   gh pr create --title "<TICKET-ID>: <title>" --body "$(cat <<'EOF'
   ## Summary
   <bullet points describing changes>

   ## Test Plan
   - [ ] <verification steps>

   Linear: <TICKET-ID>
   EOF
   )"
   ```

8. **Output summary** - Display results:
   ```
   | Item | Details |
   |------|---------|
   | **Linear Ticket** | [<TICKET-ID>](https://linear.app/axios-hq/issue/<TICKET-ID>) |
   | **Branch** | `<branch-name>` |
   | **PR** | <PR URL> |
   ```

## Error Handling

- If `git add` fails due to lock file, run `rm -f .git/index.lock` and retry.
- If branch already exists, ask user whether to use it or create a new name.
- If no changes to commit, stop and inform the user.

## Examples

```bash
# Auto-generate title from changes
/create-linear-pr ICE-T

# With explicit title
/create-linear-pr ICE-T "Update RDS Proxy vpcSubnetIds configuration"
```
